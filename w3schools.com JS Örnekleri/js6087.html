<!DOCTYPE html>
<html>
<head>
    <meta charset="iso-8859-9 Türkçe" />
    <title>js6087.html: Tutorialspoint ile olay-tabanlý indexedDB örneði.</title>
    <style>
        body {background-color:OliveDrab; color: Cyan; font-size:20px;}
        input {background-color:Navy; color:orange;}
        button {background-color: FireBrick; color: yellow; font-size:15px;}
        #göster {color:Yellow; font-size:18px;}
    </style>
    <script>
        function fonk1() {document.getElementById ("göster").innerHTML ="";}
    </script>
</head>
<body>
    <input type="button" value="reload() ile Yenile" onClick="window.location.reload();"><br/>
    <!--<input type="button" value="Sil" onClick="fonk1()">-->
    <h4>Tutorialspoint indexedDB</h4>
    <p id="göster">Paragraf</p>

    <button onclick = "arþivKayýtlarýnýEkle()">Arþiv kayýtlarýný ekle</button>
    <button onclick = "birKayýtEkle()">Bir iþgören kaydý ekle</button>
    <button onclick = "birKayýtDeðiþtir()">Bir iþgören kaydýný deðiþtir</button>
    <button onclick = "birKayýtOku()">Bir iþgören kaydýný göster</button>
    <button onclick = "tümKayýtlarýOku()">Tüm kayýtlarý göster</button>
    <button onclick = "birKayýtSil()">Bir iþgören kaydýný sil</button>
    <button onclick = "tümKayýtlarýSil()">Tüm iþgören kayýtlarýný sil</button>

    <script>
        const iþgörenKaydý = [
            ["00-01", "M.Nihat Yavaþ", (2019-1957), "mnyavas@hotmail.com"],
            ["00-02", "Z.Nihal Candan", (2019-1955), "zncandan@gmail.com"],
            ["00-03", "Hatice Yavaþ Kaçar", (2019-1951), "hykacar@yahoo.com"],
            ["00-04", "Süheyla Özbay", (2019-1953), "sozbay@gmail.com"],
            ["00-05", "Songül Yavaþ Göktürk", (2019-1959), "sygokturk@hotmail.com"],
            ["00-06", "Sevim Yavaþ", (2019-1963), "syavas@yahoo.com"],
            ["00-07", "M.Nedim Yavaþ", (2019-1961), "mnyavas@gmail.com"],
            ["01-08", "Memet Yavaþ", (2019-1934), "myavas@gmail.com"],
            ["01-09", "Haným Amanat Yavaþ", (2019-1931), "hayavas@yahoo.com"],
            ["02-10", "Bekir Yavaþ", (2019-1888), "byavas@hotmail.com"],
            ["02-11", "Fadime Yavaþ", (2019-1891), "fyavas@yahoo.com"]
        ]; // con.. sonu...

        var vt;
        if (prompt ("Veri tabanýný yeniden yaratmak istiyor musun? ", "h").toLowerCase() == "e") {indexedDB.deleteDatabase ("betteþlerVeritabaný"); }
        yaratmaTalebi = window.indexedDB.open ("betteþlerVeritabaný", 1);
        yaratmaTalebi.onerror = function (olay) {console.log ("HATA: " + yaratmaTalebi.error);};
        yaratmaTalebi.onsuccess = function (olay) {
            vt = yaratmaTalebi.result;
            console.log ("betteþlerVeritabaný'nýn yaratýlmasý baþarýlý: "+ vt);
        }; // yar.. sonu...
        yaratmaTalebi.onupgradeneeded = function (olay) {
            var vt1 = olay.target.result;
            if (! vt1.objectStoreNames.contains ("iþgörenler")) {var nesneDeposu = vt1.createObjectStore ("iþgörenler", {keyPath: "bordoNo"}); }
        } // yar.. sonu...

        function arþivKayýtlarýnýEkle() {
            for (var i in iþgörenKaydý) {
                var eklemeTalebi = vt.transaction ("iþgörenler", "readwrite")
                    .objectStore ("iþgörenler")
                    .add ({bordoNo: iþgörenKaydý [i] [0], isim: iþgörenKaydý [i] [1], yaþ: iþgörenKaydý [i] [2], eposta: iþgörenKaydý [i] [3] });
            } // for sonu...
            eklemeTalebi.onsuccess = function (olay) {alert ("Arþiv kayýtlarýnýzýn veritabaný dosyasýna eklenmesi baþarýlý."); };
            eklemeTalebi.onerror = function (olay) {alert ("HATA: Arþiv kayýtlarýnýz veritabaný dosyasýna eklenemedi!\n" + eklemeTalebi.error);}
        } // func sonu...
        function birKayýtOku() {
            var bordoNo = prompt ("Görmek istediðiniz elemanýn bordo no'sunu girin: ", "00-00");
            var okumaTalebi = vt.transaction ("iþgörenler").objectStore ("iþgörenler").get (bordoNo)
            okumaTalebi.onsuccess = function (olay) {
                if (okumaTalebi.result != undefined) {console.log (okumaTalebi.result);
                }else {alert ("Bu eleman dosyada mevcut deðil!.."); }
            } // oku.. sonu...
            okumaTalebi.onerror = function (olay) {console.log ("HATA: " + okumaTalebi.error); }
        } // func sonu...
        function tümKayýtlarýOku() {
            var nesneDeposu1 = vt.transaction ("iþgörenler").objectStore ("iþgörenler");
            var sayaç=0;
            nesneDeposu1.openCursor().onsuccess = function (olay) {// Belleðin dolmamasý için imleç tek-tek okuyacak...
                var imleç = olay.target.result;
                if (imleç) {// Okunacak kayýt kalmayýncaya dek tekrarlar...
                    console.log ("Bordo no: " + imleç.key + ", Ýsim: " + imleç.value.isim + ", Yaþ: " + imleç.value.yaþ + ", Eposta: " + imleç.value.eposta);
                    sayaç +=1;
                    imleç.continue(); // Birsonraki kaydý getir...
                } // if sonu...
            }; // nes.. sonu...
            setTimeout (function() {console.log ("\nToplam " + sayaç + " adetlik tüm kayýtlar okundu!")}, 500);
        } // func sonu...
        function birKayýtEkle() {
            var eklemeTalebi = vt.transaction ("iþgörenler", "readwrite")
                .objectStore ("iþgörenler")
                .add ({bordoNo: prompt ("Eklenecek kaydýn bordo no'sunu girin: ", "00-00"),
                    isim: prompt ("Eklenecek kaydýn ad ve soyadýný girin: "),
                    yaþ: prompt ("Eklenecek kaydýn yaþýný girin: "),
                    eposta: prompt ("Eklenecek kaydýn epostasýný girin: ") } );
            eklemeTalebi.onsuccess = function (olay) {alert ("Kaydýnýzýn veritabaný dosyasýna eklenmesi baþarýlý."); };
            eklemeTalebi.onerror = function (olay) {alert ("HATA: : " + eklemeTalebi.error);}
        } // func sonu...
        function birKayýtDeðiþtir() {
            var bordoNo = prompt ("Bilgileri deðiþtirilecek elemanýn bordo no'sunu girin: ", "00-00");
            var mevcutMu = vt.transaction ("iþgörenler").objectStore ("iþgörenler").get (bordoNo);
            mevcutMu.onsuccess = function (olay) {
                if (mevcutMu.result == undefined) {alert ("Deðiþtirilecek kayýt dosyada mevcut deðil!..");
                }else {
                    var deðiþtirmeTalebi = vt.transaction ("iþgörenler", "readwrite")
                        .objectStore ("iþgörenler")
                        .put ({bordoNo: bordoNo,
                            isim: prompt ("Deðiþecek elemanýn yeni ismini girin: "),
                            yaþ: prompt ("Yeni yaþýný girin: "),
                            eposta: prompt ("Yeni epostasýný girin: ") } );
                } // else sonu...
            } // mev.. sonu...
            mevcutMu.onerror = function (olay) {console.log ("HATA: " + mevcutMu.error); }
        } // func sonu...
        function birKayýtSil() {
            var bordoNo  = prompt ("Ýþgörenler dosyasýndan silinecek elemanýn bordo no'sunu girin: ", "00-00");
            var mevcutMu = vt.transaction ("iþgörenler").objectStore ("iþgörenler").get (bordoNo);
            mevcutMu.onsuccess = function (olay) {
                if (mevcutMu.result != undefined) {
                    var cevap = prompt ("DÝKKAT... Bu eleman dosyadan silinecek.\nEmin misiniz [e/h]:", "h");
                    if (cevap.toLowerCase() == "e") {
                        try {vt.transaction ("iþgörenler", "readwrite").objectStore ('iþgörenler').delete (bordoNo);
                        } catch (hata) {alert ("HATA: Bu elemaný silemedim.\n" + hata);}
                    } // if sonu...
                } else {alert ("Silmek istediðiniz eleman, iþgörenler veritabaný dosyasýnda mevcut deðil."); } }
            mevcutMu.onerror = function (olay) {alert ("HATA: " + mevcutMu.error); }
        } // func sonu...
        function tümKayýtlarýSil() {
            var cevap = prompt ("DÝKKAT... Veritabaný dosyanýzdaki tüm iþgören kayýtlarý silinecek.\nEmin misiniz [e/h]:", "h");
            if (cevap.toLowerCase() == "e") {vt.transaction ('iþgörenler', 'readwrite').objectStore ('iþgörenler').clear();}
        } // func sonu...

        window.addEventListener ('unhandledrejection', olay => {alert ("HATA: " + olay.reason.message); });

        document.getElementById ("göster").innerHTML =""
    </script>
</body>
</html>