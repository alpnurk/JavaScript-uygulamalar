<!DOCTYPE html>
<html>
<head>
    <meta charset="iso-8859-9 Türkçe" />
    <title>js6089b.html: Rush stüdyo albümleri 74-85, indexedDB örneði.</title>
    <style>
        body {background-color:OliveDrab; color: SkyBlue; font-size:20px; margin:3em;}
        input {background-color:Navy; color:orange;}
        button {background-color: MidnightBlue; color: Gold; font-size:15px;}
        #göster {color:Yellow; font-size:18px;}

        html {
            font-family: sans-serif;
            font-size: 10px;
            background-color:DarkGreen;}
        body {
            max-width: 800px;
            padding: 10px;
            background: linear-gradient(to bottom, rgba(150,150,255,0.8), rgba(255,150,100,0.6));}
        h1 {
            text-align: center;
            font-size: 2.5rem;
            text-shadow: 2px 2px 5px rgb(150,30,30);}
        ul {
            text-align: center;
            list-style-type: none;}
        li {
            font-size: 2rem;
            padding-bottom: 1rem;
            color: rgb(150, 100, 0, 0.85);}
        li strong {color: DarkRed;}
    </style>
</head>
<body>
    <input type="button" value="reload() ile Yenile" onClick="window.location.reload();"><br/>
    <!--<input type="button" value="Sil" onClick="fonk1()">-->
    <h4>indexedDB</h4>

    <p id="göster">Paragraf</p>

    <h1>Temel IDBCursor örneði - Rush stüdyo albümleri 74-85</h1>

    <ul></ul>

    <button class="hepsiniGöster">Tüm albümleri görelim</button>
    <button class="atlayarakGör">Birer atlayarak görelim</button>
    <button class="tekKaydýSil">Grace'i listelemizden silelim</button>
    <button class="tekKaydýDeðiþtir">'A farewell..'in yýlýný öteleyelim</button>
    <button class="terstenSýrala">Albümleri tepetakla yapalým</button>

    <script>
        var vt;
        var kayýtlar = [
            {albümBaþlýðý: 'Power windows', yýl: 1985},
            {albümBaþlýðý: 'Grace under pressure', yýl: 1984},
            {albümBaþlýðý: 'Signals', yýl: 1982},
            {albümBaþlýðý: 'Moving pictures', yýl: 1981},
            {albümBaþlýðý: 'Permanent waves', yýl: 1980},
            {albümBaþlýðý: 'Hemispheres', yýl: 1978},
            {albümBaþlýðý: 'A farewell to kings', yýl: 1977},
            {albümBaþlýðý: '2112', yýl: 1976},
            {albümBaþlýðý: 'Caress of steel', yýl: 1975},
            {albümBaþlýðý: 'Fly by night', yýl: 1975},
            {albümBaþlýðý: 'Rush', yýl: 1974}
        ]; // kay.. sonu...
        var listele = document.querySelector ('ul');
        var hepsiniGör = document.querySelector ('.hepsiniGöster');
        var atlayarakGör = document.querySelector ('.atlayarakGör');
        var kayýtSil = document.querySelector ('.tekKaydýSil');
        var tekKaydýDeðiþtir = document.querySelector ('.tekKaydýDeðiþtir');
        var tersSýrala = document.querySelector ('.terstenSýrala');

        window.onload = function() {// Tüm programý bu blokta tamamla...
            window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
            window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
            window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;

            var vtAçmaTalebi = window.indexedDB.open ('albümlerVeritabaný', 1);
            vtAçmaTalebi.onsuccess = function (olay) {
                vt = vtAçmaTalebi.result; // veya 'olay.target.result'
                kayýtlarýEkle();
            }; // vtA.. sonu...
            vtAçmaTalebi.onupgradeneeded = function (olay) {
                var vt = olay.target.result;
                vt.onerror = function (olay) {console.log ("Veritabanýný yükleme hatasý.");};
                var nesneDeposu = vt.createObjectStore ('rushAlbümDosyasý', {keyPath: 'albümBaþlýðý'});
                nesneDeposu.createIndex ('yýl', 'yýl', {unique: false});
            }; // vtA.. sonu...

            function kayýtlarýEkle() {
                var iþlem = vt.transaction (['rushAlbümDosyasý'], "readwrite");
                var nesneDeposu = iþlem.objectStore ('rushAlbümDosyasý');
                for (i = 0; i < kayýtlar.length ; i++) {var talep = nesneDeposu.put (kayýtlar [i]);}
                iþlem.oncomplete = function() {kayýtlarýGöster();}
            } // func sonu...

            function kayýtlarýGöster() {
                listele.innerHTML = '';
                var iþlem = vt.transaction (['rushAlbümDosyasý'], 'readonly');
                 var nesneDeposu = iþlem.objectStore ('rushAlbümDosyasý');
                nesneDeposu.openCursor().onsuccess = function (olay) {
                    var imleç = olay.target.result;
                    if (imleç) {
                        var listeBirimi = document.createElement ('li');
                        listeBirimi.innerHTML = '<strong>' + imleç.value.albümBaþlýðý + '</strong>, ' + imleç.value.yýl;
                        listele.appendChild (listeBirimi);
                        //console.log (imleç.source);
                        //console.log (imleç.key);
                        //console.log (imleç.primaryKey);
                        //console.log (imleç.value);
                        imleç.continue();
                    }else {console.log ('Tüm kayýtlar gösterildi.');}
                }; // nes.. sonu...
            } // func sonu...

            hepsiniGör.onclick = function() {kayýtlarýGöster();};
            atlayarakGör.onclick = function() {atlayarakGörelim();};
            kayýtSil.onclick = function() {kaydýSilelim();};
            tekKaydýDeðiþtir.onclick = function() {tekKaydýDeðiþtirelim();};
            tersSýrala.onclick = function() {tersten();}

            function atlayarakGörelim() {
                listele.innerHTML = '';
                var iþlem = vt.transaction (['rushAlbümDosyasý'], 'readonly');
                var nesneDeposu = iþlem.objectStore ('rushAlbümDosyasý');
                nesneDeposu.openCursor().onsuccess = function (olay) {
                    var imleç = olay.target.result;
                    if (imleç) {
                        var listeBirimi = document.createElement ('li');
                        listeBirimi.innerHTML = '<strong>' + imleç.value.albümBaþlýðý + '</strong>, ' + imleç.value.yýl;
                        listele.appendChild (listeBirimi);
                        imleç.advance (2);
                    }else {console.log ('Atlamalý kayýtlar gösterildi.');}
                }; // nes.. sonu...
            } // func sonu...

            function kaydýSilelim() {
                listele.innerHTML = '';
                var iþlem = vt.transaction (['rushAlbümDosyasý'], 'readwrite');
                var nesneDeposu = iþlem.objectStore ('rushAlbümDosyasý');
                nesneDeposu.openCursor().onsuccess = function (olay) {
                    var imleç = olay.target.result;
                    if (imleç) {
                        if (imleç.value.albümBaþlýðý === 'Grace under pressure') {
                            var talep = imleç.delete();
                            talep.onsuccess = function() {console.log ("!984'ün vasat albümü silindi. 'Power windows' albümü bile daha iyidir."); };
                        }else {
                            var listeBirimi = document.createElement ('li');
                            listeBirimi.innerHTML = '<strong>' + imleç.value.albümBaþlýðý + '</strong>, ' + imleç.value.yýl;
                            listele.appendChild (listeBirimi);   
                        } // else sonu...
                        imleç.continue();
                    }else {console.log ("Grace'siz listeleme tamamlandý");}
                }; // nes.. sonu...
            } // func sonu...

            function tekKaydýDeðiþtirelim() {
                listele.innerHTML = '';
                var iþlem = vt.transaction (['rushAlbümDosyasý'], 'readwrite');
                var nesneDeposu = iþlem.objectStore ('rushAlbümDosyasý');
                nesneDeposu.openCursor().onsuccess = function (olay) {
                    var imleç = olay.target.result;
                    if (imleç) {
                        if (imleç.value.albümBaþlýðý === 'A farewell to kings') {
                            var deðiþen = imleç.value;
                            deðiþen.yýl = 2050;
                            var talep = imleç.update (deðiþen);
                            talep.onsuccess = function() {console.log ('Ütobik bir albüm yýlý?..'); };
                        } // iç-if sonu...
                        var listeBirimi = document.createElement ('li');
                        listeBirimi.innerHTML = '<strong>' + imleç.value.albümBaþlýðý + '</strong>, ' + imleç.value.yýl;
                        listele.appendChild (listeBirimi);
                        imleç.continue();
                    }else {console.log ('Güncel liste tamamlandý.'); }
                }; // nes.. sonu...
            } // func sonu...

            function tersten() {
                listele.innerHTML = '';
                var iþlem = vt.transaction (['rushAlbümDosyasý'], 'readonly');
                var nesneDeposu = iþlem.objectStore ('rushAlbümDosyasý');
                nesneDeposu.openCursor (null, 'prev').onsuccess = function (olay) {// "prev" sondan baþa okur...
                    var imleç = olay.target.result;
                    if (imleç) {
                        var listeBirimi = document.createElement ('li');
                        listeBirimi.innerHTML = '<strong>' + imleç.value.albümBaþlýðý + '</strong>, ' + imleç.value.yýl;
                        listele.appendChild (listeBirimi);
                        imleç.continue();
                    }else {console.log ('Kayýtlar tersten listelendi.');}
                }; // nes.. sonu...
            } // func sonu...
        }; // win.. sonu...

        document.getElementById ("göster").innerHTML =""
    </script>
</body>
</html>