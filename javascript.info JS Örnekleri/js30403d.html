<!DOCTYPE html>
<html>
<head>
    <meta charset="iso-8859-9 Türkçe" />
    <title>js30403d.html: Tüm tablo kolonlarýnýn endekslenebildiði olay-temelli indexedDB örneði.</title>
    <style>
        body {background-color:OliveDrab; color: MidnightBlue; font-size:20px; margin:1em;}
        input {background-color:Navy; color:orange;}

        html {font-family: 'Arvo', serif;
            font-size: 10px;}
        h1 {text-align: center;
            font-family: "Bevan", cursive;
            font-size: 4rem; /* 1rem=0.5em */
            letter-spacing: 0.2rem;
            text-shadow:
                1px 1px 1px #eee4fe,
                2px 2px 1px #eee4fe,
                3px 3px 1px #7b62ae,
                4px 4px 1px #7b62ae,
                5px 5px 1px #261758,
                6px 6px 1px #261758;}
        table {width: 90%;
            font-size: 1.3rem;
            letter-spacing: 0.1rem;
            margin: 0 auto;
            border-collapse: collapse;
            box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.8);}
        table, thead {background: white;}
        tbody {border: 2px solid #eee4fe;}
        thead {border: 2px solid #261758;}
        th {font-size: 1.7rem;
            padding: 1.2rem;
            text-align: left;
            background: linear-gradient(to bottom, #261758, #868798);
            color: white;
            text-shadow: 2px 2px 2px black;
            cursor: pointer;}
        th:hover, th:focus {color: Tomato;}
        th:active {color: Lime;}
        td {padding: 1rem;
            border-left: 1px solid #7b62ae;
            border-right: 1px solid #7b62ae;}
        td:first-child {border-left: none;}
        td:last-child {border-right: none;}
        tr:nth-child(odd) {background: Khaki;}
        tr:nth-child(even) {background: DarkKhaki;}
        p {font-size: 1.5rem;
            text-align: center;}
    </style>
</head>
<body>
    <input type="button" value="reload() ile Yenile" onClick="window.location.reload();"><br/>
    <h3 style="text-decoration:underline overline; (line-through);">indexedDB</h3>

    <h1>Temel IndexedDB örneði<br/>iletiþim ajandasý</h1>
    <table>
        <thead>
            <tr>
                <th>No</th>
                <th>Soyadý</th>
                <th>Adý</th>
                <th>Yaþý</th>
                <th>Ünvaný</th>
                <th>Þirketi</th>
                <th>E-postasý</th>
                <th>GSM'i</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <p>Kolon verilerini (artan) sýralamak için herbir tablo baþlýðýný týklayýn/odaklanýn.</p>

    <script>
        let vt; // Nesne deposu kayýtlarý için bir vt/veritabaný yaratalým...
        let aktifEndeks;
        let tabloVerisi = document.querySelector ("tbody");
        let veriler = [// Uygulamada sadece bu veriler kullanýlacak, baþkaca veri ekleme, silme, deðiþtirme yapýlmayacak...
            {no: 1, ad: 'Brian', soyad: 'Damage', yaþ: 37, ünvan: 'Master of Synergies', þirket: 'Acme', eposta: 'brian@acme.com', gsm: '+441210000000'},
            {no: 2, ad: 'Ted', soyad: 'Maul', yaþ: 46, ünvan: 'Chief Reporter', þirket: 'Brass eye', eposta: 'ted@itsthenews.co.uk', gsm: '+442081111111'},
            {no: 3, ad: 'Mr', soyad: 'Bungle', yaþ: 50, ünvan: 'Bad Clown', þirket: 'Stub a Dub', eposta: 'bungle@maiof.com', gsm: '+1508888888'},
            {no: 4, ad: 'Richard', soyad: 'James', yaþ: 43, ünvan: 'Sound Engineer', þirket: 'Aphex Twin', eposta: 'richard@drukqs.com', gsm: '+1517777777'},
            {no: 5, ad: 'Brian', soyad: 'Umlaut', yaþ: 40, ünvan: 'Shredmeister', þirket: 'Minions of metal', eposta: 'brian@raiseyourhorns.com', gsm: '+14086666666'},
            {no: 6, ad: 'Jonathan', soyad: 'Crane', yaþ: 38, ünvan: 'Freelance Psychologist', þirket: 'Arkham', eposta: 'jon@arkham.com', gsm: 'yok'},
            {no: 7, ad: 'Julian', soyad: 'Day', yaþ: 43, ünvan: 'Schedule Keeper', þirket: 'Arkham', eposta: 'julian@arkham.com', gsm: 'var'},
            {no: 8, ad: 'Bolivar', soyad: 'Trask', yaþ: 55, ünvan: 'Head of R&D', þirket: 'Trask', eposta: 'bolivar@trask.com', gsm: '+14095555555'},
            {no: 9, ad: 'Cloud', soyad: 'Strife', yaþ: 24, ünvan: 'Weapons Instructor', þirket: 'Avalanche', eposta: 'cloud@avalanche.com', gsm: '+17083333333'},
            {no: 10, ad: 'Bilbo', soyad: 'Bagshot', yaþ: 43, ünvan: 'Comic Shop Owner', þirket: 'Fantasy Bazaar', eposta: 'bilbo@fantasybazaar.co.uk', gsm: '+12084444444'},
            {no: 11, ad: "M.Nihat", soyad: "Yavaþ", yaþ: (2020-1957), ünvan: "Ar-Ge'ci", þirket: "Ýflas", eposta: "mnyavas@hotmail.com", gsm: "+905515559464"},
            {no: 12, ad: "Sevim", soyad: "Yavaþ", yaþ: (2020-1963), ünvan: "Mimar", þirket: "Sevimli Ýnþaat", eposta: "sevimyavas@yahoo.com", gsm: "+905365864761"},
            {no: 13, ad: "N.Zafer", soyad: "Candan", yaþ: (2020-1977), ünvan: "Genetik Mühendisi", þirket: "Tüpbebek", eposta: "nzcandan@gmail.com", gsm: "+905325573750"},
            {no: 14, ad: "Hilal", soyad: "Göktürk", yaþ: (2020-1985), ünvan: "Fiziktedavi Doktoru", þirket: "T.Özal Hastanesi", eposta: "hgokturk@hotmail.com", gsm: "+905557449709"}
        ]; // ver.. sonu...

        window.onload = function() {// Bu program her yükleniþte bu iþlemler yapýlýr...
            window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
            window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
            window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;

            let vtAçmaTalebi = window.indexedDB.open ("verilerDeposu", 1);

            vtAçmaTalebi.onsuccess = function (olay) {
                vt = vtAçmaTalebi.result; // olay.target.result
                verileriDepoyaKoy();
            }; // vt.. sonu...

            vtAçmaTalebi.onupgradeneeded = function (olay) {
                vt = olay.target.result;
                let nesneDeposu = vt.createObjectStore ("verilerDeposu", {keyPath: "no"}); // Anahtarlý nesneDeposu...
                nesneDeposu.createIndex ('soyad', 'soyad', {unique: false}); // Her kolon için ayrý, endeksli nesneDepolarý...
                nesneDeposu.createIndex ('ad', 'ad', {unique: false});
                nesneDeposu.createIndex ('yaþ', 'yaþ', {unique: false});
                nesneDeposu.createIndex ('ünvan', 'ünvan', {unique: false});
                nesneDeposu.createIndex ('þirket', 'þirket', {unique: false});
                nesneDeposu.createIndex ('eposta', 'eposta', {unique: true}); // Dünyada herkesin epostasý farklýdýr...
                nesneDeposu.createIndex ('gsm', 'gsm', {unique: true}); // true'yu ka'ale almýyor...
            }; // vt.. sonu...

            vtAçmaTalebi.onerror = function (olay) {console.log ("Veritabaný yükleme hatasý.\n" + vtAçmaTalebi.error);} // olay.target, olay.target.name/errorCode/result...

            function verileriDepoyaKoy() {
                let iþlem = vt.transaction ("verilerDeposu", "readwrite");
                let nesneDeposu = iþlem.objectStore ("verilerDeposu");
                for (i = 0; i < veriler.length ; i++) {nesneDeposu.put (veriler [i]); }
                iþlem.oncomplete = function() {anahtarlýVerileriGöster();} 
            } // func sonu...

            function anahtarlýVerileriGöster() {
                tabloVerisi.innerHTML = "";
                let iþlem = vt.transaction ("verilerDeposu", "readonly");
                let nesneDeposu = iþlem.objectStore ("verilerDeposu");
                nesneDeposu.openCursor().onsuccess = function (olay) {
                        let imleç = olay.target.result; // nesneDeposu.result
                        if (imleç) { // Tüm kayýtlarý tarar...
                            let tabloSatýrý = document.createElement ("tr");
                            tabloSatýrý.innerHTML =
                                        '<td>' + imleç.value.no + '</td>' // imleç.key
                                        + '<td>' + imleç.value.soyad + '</td>'
                                        + '<td>' + imleç.value.ad + '</td>'
                                        + '<td>' + imleç.value.yaþ + '</td>'
                                        + '<td>' + imleç.value.ünvan + '</td>'
                                        + '<td>' + imleç.value.þirket + '</td>'
                                        + '<td>' + imleç.value.eposta + '</td>'
                                        + '<td>' + imleç.value.gsm + '</td>';
                            tabloVerisi.appendChild (tabloSatýrý);  
                            imleç.continue();
                        }else {console.log ("Tüm içerikler gösterildi.");}
                }; // nes.. sonu...
            } // func sonu...

            let baþlýkTýklamaKontrolleri = document.querySelectorAll ("th");
            for (i = 0; i < baþlýkTýklamaKontrolleri.length; i++) {// Tüm th baþlýk sayýsý: 8 adet...
                let aktifBaþlýk = baþlýkTýklamaKontrolleri [i];
                aktifBaþlýk.onclick = function (olay) {// Hangi baþlýk týklanýr/aktiflenirse onun endeksiyle görüntülenecek...
                        aktifEndeks = olay.target.innerHTML;
                        if (aktifEndeks == 'No') {anahtarlýVerileriGöster();
                        }else {
                            if (aktifEndeks == "Soyadý") {endeksliVerileriGöster ('soyad');
                            }else if (aktifEndeks == "Adý") {endeksliVerileriGöster ('ad');
                            }else if (aktifEndeks == "Yaþý") {endeksliVerileriGöster ('yaþ');
                            }else if (aktifEndeks == "Ünvaný") {endeksliVerileriGöster ('ünvan');
                            }else if (aktifEndeks == "Þirketi") {endeksliVerileriGöster ('þirket');
                            }else if (aktifEndeks == "E-postasý") {endeksliVerileriGöster ('eposta');
                            }else if (aktifEndeks == "GSM'i") {endeksliVerileriGöster ('gsm');}
                        } // else sonu...
                }; // akt.. sonu...
            } // for sonu...

            function endeksliVerileriGöster (aktifEndeks) {
                tabloVerisi.innerHTML = "";
                let iþlem = vt.transaction ("verilerDeposu", "readonly");
                let nesneDeposu = iþlem.objectStore ("verilerDeposu");
                let aktifEndeksim = nesneDeposu.index (aktifEndeks);

                console.log (aktifEndeksim.name); // aktiflenen endeksin adý...
                console.log (aktifEndeksim.objectStore); // nesne deposu adý...
                console.log (aktifEndeksim.keyPath); // endeks anahtarý...
                console.log (aktifEndeksim.multiEntry); // çoklu enkeks mi?
                console.log (aktifEndeksim.unique); // yegane mi?

                let kayýtSayýsýTalebi = aktifEndeksim.count();
                kayýtSayýsýTalebi.onsuccess = function() {console.log (kayýtSayýsýTalebi.result);}

                if (aktifEndeks == 'ad') {
                        let alTalebi = aktifEndeksim.get ("M.Nihat");
                        alTalebi.onsuccess = function() {console.log (alTalebi.result);}
                } // if sonu...
                if (aktifEndeks == 'soyad') {
                        let alAnahtarTalebi = aktifEndeksim.getKey ("Yavaþ");
                        alAnahtarTalebi.onsuccess = function() {console.log (alAnahtarTalebi.result);}
                } // if sonu...

                aktifEndeksim.openCursor().onsuccess = function (olay) {
                        let imleç = olay.target.result;
                        if (imleç) {
                            let tabloSatýrý = document.createElement ("tr");
                            tabloSatýrý.innerHTML =
                                        '<td>' + imleç.key + '</td>' // imleç.value.no
                                        + '<td>' + imleç.value.soyad + '</td>'
                                        + '<td>' + imleç.value.ad + '</td>'
                                        + '<td>' + imleç.value.yaþ + '</td>'
                                        + '<td>' + imleç.value.ünvan + '</td>'
                                        + '<td>' + imleç.value.þirket + '</td>'
                                        + '<td>' + imleç.value.eposta + '</td>'
                                        + '<td>' + imleç.value.gsm + '</td>';
                            tabloVerisi.appendChild (tabloSatýrý);
                            imleç.continue();
                        }else {console.log ("Tüm içerikler gösterildi.");}
                }; // akt.. sonu...
            } // func sonu...
        }; // win.. sonu...
    </script>
</body>
</html>