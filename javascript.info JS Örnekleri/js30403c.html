<!DOCTYPE html>
<html>
<head>
    <meta charset="iso-8859-9 Türkçe" />
    <title>js30403c.html: Tutorialspoint.com ile olay-tabanlý indexedDB örneði.</title>
    <style>
        body {background-color:OliveDrab; color: Cyan; font-size:20px;}
        input {background-color:Navy; color:orange;}
        button {background-color: FireBrick; color: yellow; font-size:15px;}
    </style>
</head>
<body>
    <input type="button" value="reload() ile Yenile" onClick="window.location.reload();"><br/>
    <h4>Tutorialspoint indexedDB</h4>

    <button onclick = "arþivKayýtlarýnýEkle()">Arþiv kayýtlarýný ekle</button>
    <button onclick = "birKayýtEkle()">Bir iþgören kaydý ekle</button>
    <button onclick = "birKayýtDeðiþtir()">Bir iþgören kaydýný deðiþtir</button>
    <button onclick = "birKayýtOku()">Bir iþgören kaydýný göster</button>
    <button onclick = "tümKayýtlarýOku()">Tüm kayýtlarý göster</button>
    <button onclick = "birKayýtSil()">Bir iþgören kaydýný sil</button>
    <button onclick = "tümKayýtlarýSil()">Tüm iþgören kayýtlarýný sil</button>

    <script>
        const iþgörenKaydý = [
            ["00-01", "M.Nihat Yavaþ", (2020-1957), "mnyavas@hotmail.com"],
            ["00-02", "Z.Nihal Candan", (2020-1955), "zncandan@gmail.com"],
            ["00-03", "Hatice Yavaþ Kaçar", (2020-1951), "hykacar@yahoo.com"],
            ["00-04", "Süheyla Özbay", (2020-1953), "sozbay@gmail.com"],
            ["00-05", "Songül Yavaþ Göktürk", (2020-1959), "sygokturk@hotmail.com"],
            ["00-06", "Sevim Yavaþ", (2020-1963), "syavas@yahoo.com"],
            ["00-07", "M.Nedim Yavaþ", (2020-1961), "mnyavas@gmail.com"],
            ["01-08", "Memet Yavaþ", (2020-1934), "myavas@gmail.com"],
            ["01-09", "Haným Amanat Yavaþ", (2020-1931), "hayavas@yahoo.com"],
            ["02-10", "Bekir Yavaþ", (2020-1888), "byavas@hotmail.com"],
            ["02-11", "Fadime Yavaþ", (2020-1891), "fyavas@yahoo.com"]
        ]; // con.. sonu...

        let vt;
        if (prompt ("Veri tabanýný yeniden yaratmak istiyor musun? ", "h").toLowerCase() == "e") {indexedDB.deleteDatabase ("betteþlerVeritabaný"); }
        yaratmaTalebi = window.indexedDB.open ("betteþlerVeritabaný", 1);
        yaratmaTalebi.onerror = function() {console.log ("HATA: " + yaratmaTalebi.error);};
        yaratmaTalebi.onsuccess = function() {
            vt = yaratmaTalebi.result;
            console.log ("betteþlerVeritabaný'nýn yaratýlmasý baþarýlý: "+ vt);
        }; // yar.. sonu...
        yaratmaTalebi.onupgradeneeded = function (olay) {
            let vt1 = olay.target.result; // yaratmaTalebi.result
            if (! vt1.objectStoreNames.contains ("iþgörenler")) {let nesneDeposu = vt1.createObjectStore ("iþgörenler", {keyPath: "bordoNo"}); }
        } // yar.. sonu...

        function arþivKayýtlarýnýEkle() {
            let eklemeTalebi;
            for (let i in iþgörenKaydý) {
                eklemeTalebi = vt.transaction ("iþgörenler", "readwrite")
                    .objectStore ("iþgörenler")
                    .add ({bordoNo: iþgörenKaydý [i] [0], isim: iþgörenKaydý [i] [1], yaþ: iþgörenKaydý [i] [2], eposta: iþgörenKaydý [i] [3] });
            } // for sonu...
            eklemeTalebi.onsuccess = function() {alert ("Arþiv kayýtlarýnýzýn veritabaný dosyasýna eklenmesi baþarýlý."); };
            eklemeTalebi.onerror = function() {alert ("HATA: Arþiv kayýtlarýnýz veritabaný dosyasýna eklenemedi!\n" + eklemeTalebi.error);}
        } // func sonu...

        function birKayýtOku() {
            let bordoNo = prompt ("Görmek istediðiniz elemanýn bordo no'sunu girin: ", "00-00");
            if (bordoNo == "") return false;
            let okumaTalebi = vt.transaction ("iþgörenler").objectStore ("iþgörenler").get (bordoNo)
            okumaTalebi.onsuccess = function() {
                let sonuç = okumaTalebi.result;
                if (sonuç != undefined) {console.log ("Sonuç nesnesi: ", sonuç);
                    console.log ("Sonuç detaylarý:\nBordo no: " + sonuç.bordoNo + ", Ýsim: " + sonuç.isim + ", Yaþ: " + sonuç.yaþ + ", Eposta: " + sonuç.eposta);
                }else {alert ("Bu eleman dosyada mevcut deðil!.."); }
            } // oku.. sonu...
            okumaTalebi.onerror = function() {console.log ("HATA: " + okumaTalebi.error); }
        } // func sonu...

        function tümKayýtlarýOku() {
            let nesneDeposu1 = vt.transaction ("iþgörenler").objectStore ("iþgörenler");
            let sayaç=0;
            nesneDeposu1.openCursor().onsuccess = function (olay) {// Belleðin dolmamasý için imleç tek-tek okuyacak...
                let imleç = olay.target.result;
                if (imleç) {// Okunacak kayýt kalmayýncaya dek tekrarlar...
                    console.log ("Bordo no: " + imleç.key + ", Ýsim: " + imleç.value.isim + ", Yaþ: " + imleç.value.yaþ + ", Eposta: " + imleç.value.eposta);
                    sayaç +=1;
                    imleç.continue(); // Birsonraki kaydý getir...
                } // if sonu...
            }; // nes.. sonu...
            setTimeout (()=>{console.log ("\nToplam " + sayaç + " adetlik tüm kayýtlar okundu!")}, 500);
        } // func sonu...

        function birKayýtEkle() {
            let bNo = prompt ("Eklenecek kaydýn bordo no'sunu girin: ", "00-00");
            if (bNo == "") return false;
            let mevcutMu = vt.transaction ("iþgörenler").objectStore ("iþgörenler").get (bNo);
            mevcutMu.onsuccess = function() {
                if (mevcutMu.result == undefined) {
                    let eklemeTalebi = vt.transaction ("iþgörenler", "readwrite")
                        .objectStore ("iþgörenler")
                        .add ({bordoNo: bNo,
                            isim: prompt ("Eklenecek kaydýn ad ve soyadýný girin: "),
                            yaþ: prompt ("Eklenecek kaydýn yaþýný girin: "),
                            eposta: prompt ("Eklenecek kaydýn epostasýný girin: ") } );
                    eklemeTalebi.onsuccess = function() {alert ("Kaydýnýzýn veritabaný dosyasýna eklenmesi baþarýlý."); };
                    eklemeTalebi.onerror = function() {alert ("HATA: : " + eklemeTalebi.error);}
                }else {alert ("Bu kayýt halihazýrda dosyada mevcut!..");}
            }; // mev..sonu...
            mevcutMu.onerror = function() {console.log ("HATA: " + mevcutMu.error); }
        } // func sonu...

        function birKayýtDeðiþtir() {
            let bNo = prompt ("Bilgileri deðiþtirilecek elemanýn bordo no'sunu girin: ", "00-00");
            if (bNo == "") return false;
            let mevcutMu = vt.transaction ("iþgörenler").objectStore ("iþgörenler").get (bNo);
            mevcutMu.onsuccess = function() {
                if (mevcutMu.result == undefined) {alert ("Deðiþtirilecek kayýt dosyada mevcut deðil!..");
                }else {
                    let deðiþtirmeTalebi = vt.transaction ("iþgörenler", "readwrite")
                        .objectStore ("iþgörenler")
                        .put ({bordoNo: bNo,
                            isim: prompt ("Deðiþecek elemanýn yeni ismini girin: "),
                            yaþ: prompt ("Yeni yaþýný girin: "),
                            eposta: prompt ("Yeni epostasýný girin: ") } );
                } // else sonu...
            } // mev.. sonu...
            mevcutMu.onerror = function() {console.log ("HATA: " + mevcutMu.error); }
        } // func sonu...

        function birKayýtSil() {
            let bNo  = prompt ("Ýþgörenler dosyasýndan silinecek elemanýn bordo no'sunu girin: ", "00-00");
            if (bNo == "") return false;
            let mevcutMu = vt.transaction ("iþgörenler").objectStore ("iþgörenler").get (bNo);
            mevcutMu.onsuccess = function() {
                if (mevcutMu.result != undefined) {
                    let cevap = prompt ("DÝKKAT... Bu eleman dosyadan silinecek.\nEmin misiniz [e/h]:", "h");
                    if (cevap.toLowerCase() == "e") {
                        try {vt.transaction ("iþgörenler", "readwrite").objectStore ('iþgörenler').delete (bNo);
                        }catch (ist) {alert ("HATA: Bu elemaný silemedim.\n" + ist);}
                    } // if sonu...
                }else {alert ("Silmek istediðiniz eleman, iþgörenler veritabaný dosyasýnda mevcut deðil."); } }
            mevcutMu.onerror = function() {alert ("HATA: " + mevcutMu.error); }
        } // func sonu...

        function tümKayýtlarýSil() {
            let cevap = prompt ("DÝKKAT... Veritabaný dosyanýzdaki tüm iþgören kayýtlarý silinecek.\nEmin misiniz [e/h]:", "h");
            if (cevap.toLowerCase() == "e") {vt.transaction ('iþgörenler', 'readwrite').objectStore ('iþgörenler').clear();}
        } // func sonu...

        window.addEventListener ("unhandledrejection", olay => {alert ("HATA: " + olay.reason.message); });
    </script>
</body>
</html>